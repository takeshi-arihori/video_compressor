# TCP File Transfer Application

このアプリケーションは、Python で書かれたシンプルな TCP ファイル転送ツールです。クライアント側からサーバー側へのファイル転送を行うことができます。

## 目的

インターネット上でファイルを転送する際に TCP 接続を利用する理由と、その過程で用いるカスタムアプリケーション層プロトコルについて説明します。TCP 接続を選択した主な理由は、データパケットの到着を保証する必要があるためです。また、転送プロセスを効率化するために、独自のプロトコルを設計し、メッセージを「ヘッダ」と「データ」の二つの部分に分割します。

#### データの構造

ヘッダ: 各メッセージは 64 ビット（または 8 バイト）のヘッダで開始します。このヘッダには、ファイル名の長さ、追加情報を含む JSON ファイルのサイズ、およびデータ本体の長さが含まれます。

#### 最初のバイトはファイル名の総バイトサイズを示し、最大 255 文字まで対応します。

次の 3 バイトは、サーバーが必要とする可能性のある追加情報を含む JSON ファイルのサイズを示し、最大 16MB まで対応します。
その後の 4 バイトは、転送するファイルデータの総バイトサイズを表し、最大 4GB までの転送が可能です。
データ: ヘッダに続いて、ファイルデータが転送されます。データは 4096 バイト単位で読み込まれ、送信されます。このサイズは、一般的な読み込みバッファサイズ（2048 バイトから 8192 バイト）の中間値として選ばれています。

#### 拡張機能

本文書で紹介される基本的なプロトコル構造に加えて、「オプション」として追加の設定データを渡すことが可能です。これにより、クライアントとサーバはより柔軟にデータ処理をカスタマイズできます。

#### 注意点

このプロトコル設計は、確実なデータ転送と効率的なデータ処理を目的としています。しかし、実装にあたっては、転送するデータのサイズや種類に応じて適切なバッファサイズやエラーハンドリングを検討する必要があります。

## 前提条件

- 1. Python 3.x がインストールされていること。
- 2. TCP 通信を許可するファイアウォールの設定。

## セットアップ

- このリポジトリをクローンまたはダウンロードします。
- tcpNetworkSocket ディレクトリに移動します。

## サーバーの起動

- ターミナルを開き、サーバーを起動するディレクトリに移動します。

以下のコマンドを実行してサーバーを起動します。

```
python server.py
```

サーバーが指定されたポートでリスニングを開始します。

## クライアントからのファイル転送

別のターミナルを開き、クライアントを起動するディレクトリに移動します。

以下のコマンドを実行してクライアントを起動します。

```
python client.py
```

画面の指示に従って、サーバーのアドレス（例: localhost）と転送したいファイルのパスを入力します。

## 注意事項

- ファイル転送が完了すると、クライアントとサーバーは自動的に接続を閉じます。
- 使用中のポートが既に他のアプリケーションによって使用されている場合は、server.py 内のポート番号を変更してください。
- 転送するファイルのサイズは 2GB 以下にしてください。

## エラー処理

ポートが使用中の場合は、OSError: [Errno 48] Address already in use エラーが表示されます。これは、指定されたポートが既に使用されていることを意味します。別のポート番号を使用するか、該当するプロセスを終了させてください。
指定したファイルが見つからない場合は、FileNotFoundError が発生します。ファイルパスが正しいことを確認してください。

#### ポートの削除

- 1. ポートを使用しているプロセスの特定
     ターミナルを開きます。

- 2. 使用中のポートを特定するコマンドを実行します。 以下のコマンドを使用して、特定のポート（ここでは 9001 を例とします）を使用しているプロセスを探します。

```
sudo lsof -i :9001
```

このコマンドは、ポート 9001 を使用しているプロセスのリストを表示します。結果には、プロセスの ID（PID）も含まれています。

- 3. プロセスの終了
     特定したプロセスを終了させるには、そのプロセスの PID を使用します。

- 4. kill コマンドを使用してプロセスを終了します。 プロセスを強制終了させるには、以下のコマンドを実行します。<PID> は、終了させたいプロセスの PID に置き換えてください。

```
kill -9 <PID>
```

例えば、PID が 12345 のプロセスを終了させたい場合は、以下のように入力します。

```
kill -9 12345
```
